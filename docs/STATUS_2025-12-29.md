# EFI Candidates App - Status Report
**Date:** December 29, 2025

## Current State

### Data
- **Google Sheet:** 19 candidates (rows 2-20)
- **Web App:** 20 candidates (includes 1 test candidate)
- **Photos:** Not yet attached (Photo Folder column empty in sheet)

### What's Working
1. **Push Script** (`FINAL_sheet_to_app.txt`) - Successfully pushing candidates from Sheet to Web App
2. **Web App Dashboard** - Displaying all candidates with Bulgarian UI
3. **Telegram Notifications** - Triggered on new candidates
4. **Approve/Reject Flow** - Functional via Telegram buttons

### What's Pending
1. **Gmail Extraction** - Blocked by Gmail API quota (resets ~10 AM Bulgarian time)
2. **Photo Extraction** - Requires Gmail script to run and save photos to Google Drive
3. **Photo URLs** - Will be populated when Gmail script extracts attachments to Drive folders

## Scripts Overview

### Script 1: Gmail → Sheet (`FINAL_gmail_to_sheet.txt`)
- **Location:** Google Apps Script in the Sheet
- **Functions:**
  - `runFullBackfill()` - ONE TIME: Fetches ALL historical emails
  - `runIncrementalSync()` - Every 2 hours: Fetches recent emails
  - `setupAutoSync()` - Enables automatic 2-hour sync
- **Status:** Ready, but Gmail quota exhausted

### Script 2: Sheet → App (`FINAL_sheet_to_app.txt`)
- **Location:** Google Apps Script in the Sheet (separate file)
- **Functions:**
  - `pushNewCandidates()` - Push new rows to web app
  - `pushAllCandidates()` - Reset and push ALL (use from menu)
  - `resetAndPush()` - Reset and push (use from script editor)
  - `testConnection()` - Verify API connection
  - `setupAutoPush()` - Enable 10-minute auto-push
- **Status:** Working correctly

## Sheet Structure (18 columns)
| Col | Letter | Name | Notes |
|-----|--------|------|-------|
| 1 | A | Date | Submission date |
| 2 | B | Time | Submission time |
| 3 | C | Име (First Name) | |
| 4 | D | Фамилия (Last Name) | |
| 5 | E | Email | Required field |
| 6 | F | Телефон (Phone) | |
| 7 | G | Дата на раждане (Birth Date) | |
| 8 | H | Височина (Height cm) | |
| 9 | I | Instagram | |
| 10 | J | TikTok | |
| 11 | K | Град (City) | |
| 12 | L | Категория (Category) | |
| 13 | M | Message ID | Gmail message ID |
| 14 | N | Photo Folder | Google Drive folder URL |
| 15 | O | Is Minor | "Да" for under 18 |
| 16 | P | Parent Name | For minors |
| 17 | Q | Parent Email | For minors |
| 18 | R | Parent Phone | For minors |

## Environment Variables (Vercel Production)
- `TELEGRAM_BOT_TOKEN`: Set ✓
- `TELEGRAM_ADMIN_CHAT_ID`: Set ✓
- `API_KEY`: Set ✓
- `BREVO_API_KEY`: Set ✓
- `BREVO_LIST_ID`: Set ✓
- `DATABASE_URL`: Set ✓

## Next Steps (Tomorrow)
1. Wait for Gmail quota reset (~10 AM Bulgarian time)
2. Run `runFullBackfill()` to extract all emails with photos
3. Run `pushAllCandidates()` to update candidates with photo URLs
4. Set up `setupAutoSync()` for Gmail extraction (2-hour interval)
5. Set up `setupAutoPush()` for Sheet→App push (10-minute interval)
6. Configure Brevo email automation in Brevo dashboard

## Known Issues
- **Gmail API Quota:** Daily limit exceeded. Resets at midnight Pacific Time.
- **Photo Display:** Photos show "Няма снимки" because Photo Folder column is empty. Will be populated after Gmail extraction runs.

## Authentication Note
The Push script must be authorized from the **casting email account** (not personal account) to have proper permissions for the Sheet and Drive access.
